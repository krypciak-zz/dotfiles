# Partition disks
# Crypt setup
# Crypt open lvmcrypt
pvcreate /dev/mapper/lvmcrypt
vgcreate Artix /dev/mapper/lvmcrypt
lvcreate --contiguous y --size 1G Artix -n swap
lvcreate --contiguous y --size 15G Artix -n root
lvcreate --contiguous y --extents 100%FREE Artix -n home
mkfs.fat -n EFI /dev/vda1
mkswap -L swap /dev/Artix/swap
mkfs.btrfs -f -L root /dev/Artix/root
mkfs.btrfs -f -L home /dev/Artix/home
swapon /dev/Artix/swap
mkdir -p /mnt/boot
mount /dev/vda1 /mnt/boot
mkdir -p /mnt/home/krypek
mount /dev/Artix/home /mnt/home/krypek
basestrap /mnt base base-devel openrc elogind-openrc opendoas
basestrap /mnt linux-zen linux-firmware
fstabgen -U /mnt >> /mnt/etc/fstab
artix-chroot /mnt bash
ln -sf /usr/share/zoneinfo/Europe/Warsaw /etc/localtime
hwclock --systohc
printf 'en_US ISO-8859-1\nen_US.UTF-8 UTF-8\n' > /etc/locale.gen
locale-gen
printf 'export LANG="en_US.UTF-8"\n' > /etc/locale.conf
export LANG="en_US.UTF-8"
printf 'hostname="krypekartix"\n' > /etc/conf.d/hostname
printf 'hostname="krypekartix"\n' > /etc/hostname
sed -i -e 's/HOOKS=(base udev autodetect modconf block filessystems keyboard fsck)/HOOKS=\(base udev autodetect modconf block encrypt keyboard keymap lvm2 resume filesystems fsck\)/g' /etc/mkinitcpio.conf
pacman -S lvm2 cryptsetup glibc mkinitcpio
mkinitcpio -p linux-zen
pacman -S grub
    

    # /etc/default/grub
        uncomment GRUB_ENABLE_CRYPTODISK=y
        GRUB_CMDLINE_LINUX="cryptdevice=UUID=bul:lvmcrypt root=/dev/mapper/Artix-root"

pacman -S dosfstools freetype2 fuse2 mtools device-mapper-openrc lvm2-openrc cryptsetup-openrc
rc-update add device-mapper boot
rc-update add lvm boot
rc-update add dmcrypt boot
pacman -S networkmanager-openrc
rc-update add NetworkManager default

grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=Artix
grub-mkconfig -o /boot/grub/grub.cfg

exit
umount -R /mnt
swapoff -a
sync
reboot
